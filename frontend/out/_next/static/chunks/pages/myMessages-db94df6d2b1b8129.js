(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{6142:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Y}});var s=n(1080),c=n.n(s),a=n(959),r=n(7650),o=n(7986),u=n(2530),i=n(1761),l=n(5177),_=n(4522),m=n(6943),f=n(5817),d=n(6186),g=n(891),h=n.n(g),v=n(6563),p=n(9927),E=n(3715),M=n(2987);function y(e){let t=(0,a.useRef)(null),n=(0,a.useRef)(null);return n.current&&n.current.update(e),(0,a.useEffect)(()=>(n.current=new M.cW({...e,ref:t}),()=>{n.current=null}),[]),a.createElement("div",{ref:t})}var b=n(185),C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},w=n(807),k=function(e,t){return a.createElement(w.Z,(0,b.Z)((0,b.Z)({},e),{},{ref:t,icon:C}))};k.displayName="SmileOutlined";var x=a.forwardRef(k),N=n(8552),O=n(4981),Z=n(5276),S=n(5858),j=n.n(S),P=N.Z.TextArea,R=function(e){var t=e.setMessageData,n=e.interlocutor,s=(0,a.useState)(!1),c=s[0],r=s[1],o=(0,a.useState)(""),u=o[0],l=o[1],_=(0,i.I0)(),m=(0,a.useRef)(null),f=(0,a.useRef)(null),d=(0,i.v9)(function(e){return e.socket.socket}),g=(0,i.v9)(function(e){return e.user.user}),h=(0,a.useCallback)(function(e){l(function(t){return t+(null==e?void 0:e.native)})},[l]),v=(0,a.useCallback)(function(){r(function(e){return!e})},[c,r]),M=(0,a.useCallback)(function(){u&&d.emit("message",{from:g.id,to:n.id,message:u},function(e){e.between&&(t(e),l(""),_((0,p.kC)(e)))})},[u,d,t,g,n]);return(0,Z.t$)(m,function(e){c&&!(e.target==f.current||f.current.contains(e.target))&&r(!1)}),a.createElement("div",{className:j().inputs_cont},a.createElement(P,{value:u,className:j().chat_textarea,onChange:function(e){return l(e.target.value)}}),a.createElement(x,{ref:f,size:50,className:j().smile_icon,onClick:v}),a.createElement(O.ZP,{type:"primary",className:j().send_button,onClick:M},"Send"),c&&a.createElement("div",{ref:m,className:j().emoji_cont,style:{width:"280px"}},a.createElement(y,{dynamicWidth:!0,theme:"dark",data:E,onEmojiSelect:h})))},I=n(2881),q=function(){var e,t,n,s,c,r=(0,a.useState)({between:[],messages:[],sequence:[]}),o=r[0],g=r[1],E=(0,a.useState)({}),M=E[0],y=E[1],b=(0,d.useMediaQuery)({query:"(max-width: 750px)"}),C=(0,d.useMediaQuery)({query:"(max-width: 500px)"}),w=(0,a.useRef)(null),k=(0,i.I0)(),x=(0,i.v9)(function(e){return e.user.user}),N=(0,a.useState)(x),O=N[0],Z=N[1],S=null===(e=O.blockedUsers)||void 0===e?void 0:e.includes(M.id),j=(null===(t=O.sentRequests)||void 0===t?void 0:t.includes(M.id))||(null===(n=O.friendRequests)||void 0===n?void 0:n.includes(M.id)),P=null===(s=O.friends)||void 0===s?void 0:s.includes(M.id),q=(0,i.v9)(function(e){return e.messages.interlocutor}),D=(0,i.v9)(function(e){return e.socket.socket}),z=(0,u.useRouter)();return(0,a.useEffect)(function(){O.name?y({}):z.replace("/")},[O]),(0,a.useEffect)(function(){y(q),null!=q&&q.name&&D&&D.emit("newInterlocutor",{id:O.id,userId:q.id},function(e){k((0,p.MG)(e))})},[q]),(0,a.useEffect)(function(){g({between:[],messages:[],sequence:[]}),D&&(D.emit("getMessages",{interlocuters:[O.id,M.id]},function(e){g(e)}),D.on("message",function(e){if((0,v.Xw)(null==e?void 0:e.between,O.id)==M.id){g(e);return}k((0,p.kC)(e))})),y(q)},[M,D]),(0,a.useEffect)(function(){w.current&&(w.current.scrollTop=w.current.scrollHeight)},[o]),(0,a.useEffect)(function(){Z(x)},[x]),a.createElement("div",{className:h().chat_cont,style:{width:C?"100%":b?"42%":"50%"}},M.name?a.createElement(a.Fragment,null,a.createElement("div",{className:h().interlocutor_cont},a.createElement("div",null,a.createElement(I.Z,{type:P?"friend":"all",isRequested:j,isBlocked:S,user:M})),a.createElement("div",{className:h().interlocutor_cont_name},a.createElement("h5",{className:h().interlocutor_name},M.name?M.name.length<15?M.name:(0,v.HY)(M.name,15):""),a.createElement(l.Z,{dot:!!M.active},a.createElement(_.C,{className:h().interlocutor_avatar,src:M.image})))),a.createElement("div",{className:h().messages_cont,ref:w},o.blocked&&a.createElement("div",{className:h().blocked_cont},o.blockedBy===o.between.indexOf(O.id)?"Blocked by you":"You were blocked"),o.messages&&(null===(c=o.messages)||void 0===c?void 0:c.map(function(e,t){var n=o.between.indexOf(O.id);return a.createElement("div",{key:t,className:h().message_cont,style:{justifyContent:o.sequence[t]==n?"flex-end":"flex-start"}},a.createElement("div",{className:h().message_cont_text_cont},e))}))),a.createElement(R,{setMessageData:g,interlocutor:M})):a.createElement("div",{className:h().choose_interlocutor_cont},a.createElement(f.Z,{className:h().choose_interlocutor_icon}),a.createElement(m.Z,{className:h().choose_interlocutor},"Choose your interlocutor and start messaging")))},D=n(3045),z=n(2156),L=n(9917),Q=n(5144),A=n.n(Q),T=n(2699),G=n(4288),B=n(6914),F=n(3477),X=n.n(F);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach(function(t){(0,L.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var J=function(){var e=(0,a.useState)(100),t=e[0],n=e[1],s=(0,a.useState)(""),c=s[0],r=s[1],o=(0,a.useState)([]),u=o[0],l=o[1],_=(0,a.useState)(1),f=_[0],g=_[1],h=(0,a.useRef)(1),v=(0,a.useRef)(!1),p=(0,d.useMediaQuery)({query:"(max-width: 750px)"}),E=(0,d.useMediaQuery)({query:"(max-width: 500px)"}),M=(0,i.v9)(function(e){return e.messages}),y=M.interlocutor,b=M.interlocutorMessages,C=(0,a.useCallback)(function(e){return(console.log(y.name),e||!y.name)?[]:[V(V({},y),{},{lastMessage:(0,T.last)(b.messages)||""})]},[y,b]),w=(0,a.useCallback)(function(){(0,z.Z)(A().mark(function e(){var t,s,c,a,r;return A().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,B.Z)("GetLastMessages",{page:h.current});case 2:(r=(a=(null==(c=e.sent)?void 0:null===(t=c.GetLastMessages)||void 0===t?void 0:t.users)||[]).filter(function(e){return e.email===y.email})[0])&&(a=(0,T.sortBy)(a,function(e){return e.id===r.id?0:1})),l(function(e){return e.length?[C(r)].concat((0,D.Z)(e),(0,D.Z)(a||[])):[].concat((0,D.Z)(e),(0,D.Z)(a||[]))}),n(null==c?void 0:null===(s=c.GetLastMessages)||void 0===s?void 0:s.total),v.current=!1,g(h.current);case 11:case"end":return e.stop()}},e)}))()},[h]);return(0,a.useEffect)(function(){!v.current&&c.startsWith("newPage")&&(h.current=h.current+1,w(),v.current=!0)},[c]),(0,a.useEffect)(function(){w()},[]),(0,a.useEffect)(function(){console.log(u)},[u]),a.createElement("div",{className:X().lastMessages_cont,style:{width:E?"100%":p?"58%":"50%"}},a.createElement(m.Z,{className:X().lastMessages_cont_title},"Last Messages"),a.createElement("div",{className:"centered_users_cont"},a.createElement(G.Z,{lastMessages:!0,total:t,page:f,loadingSearchType:c,setLoadingSearchType:r,users:u})))},W=r.Z.Content,Y=function(){var e=(0,u.useRouter)(),t=(0,i.v9)(function(e){return e.window.menuOption}),n=(0,d.useMediaQuery)({query:"(max-width: 500px)"});return(0,a.useEffect)(function(){localStorage.getItem("token")||e.replace(404)},[]),a.createElement(W,{style:{height:"calc(100vh - 180px)"}},a.createElement(c(),null,a.createElement("title",null,"My Messages")),a.createElement(o.Z,{style:{height:"100%",border:"1px solid green"}},n?"lastMessages"===t?a.createElement(J,null):a.createElement(q,null):a.createElement(a.Fragment,null,a.createElement(J,null),a.createElement(q,null))))}},7675:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/myMessages",function(){return n(6142)}])},3477:function(e){e.exports={lastMessages_cont:"LastMessages_lastMessages_cont__045ax",lastMessages_cont_title:"LastMessages_lastMessages_cont_title__DhfvP"}},891:function(e){e.exports={chat_cont:"MessagesChat_chat_cont__VQpAz",interlocutor_cont:"MessagesChat_interlocutor_cont__uh2E_",interlocutor_cont_info:"MessagesChat_interlocutor_cont_info__RFQP_",interlocutor_cont_info_icon:"MessagesChat_interlocutor_cont_info_icon__HIdZ4",interlocutor_cont_info_active:"MessagesChat_interlocutor_cont_info_active__F2nFc",interlocutor_cont_name:"MessagesChat_interlocutor_cont_name__MLpoE",interlocutor_name:"MessagesChat_interlocutor_name__vpV4V",interlocutor_avatar:"MessagesChat_interlocutor_avatar__m0gJ4",interlocutor_cont_add_friend:"MessagesChat_interlocutor_cont_add_friend__RApOz",messages_cont:"MessagesChat_messages_cont__J_DJ9",message_cont:"MessagesChat_message_cont__aUOVn",message_cont_text_cont:"MessagesChat_message_cont_text_cont__vYbfc",blocked_cont:"MessagesChat_blocked_cont__23EpI",choose_interlocutor_cont:"MessagesChat_choose_interlocutor_cont__8nZL2",choose_interlocutor:"MessagesChat_choose_interlocutor__piGDX",choose_interlocutor_icon:"MessagesChat_choose_interlocutor_icon__6aGg7",chat_icon:"MessagesChat_chat_icon__fe6IP"}},5858:function(e){e.exports={inputs_cont:"MessagesInput_inputs_cont__9sTio",chat_textarea:"MessagesInput_chat_textarea__Smawk",smile_cont:"MessagesInput_smile_cont__lsXct",smile_icon:"MessagesInput_smile_icon__guhM0",send_button:"MessagesInput_send_button__3QP79",emoji_cont:"MessagesInput_emoji_cont__RziDt"}},1080:function(e,t,n){e.exports=n(7663)}},function(e){e.O(0,[910,495,888,774,179],function(){return e(e.s=7675)}),_N_E=e.O()}]);