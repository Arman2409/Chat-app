(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[858],{7675:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/myMessages",function(){return t(1386)}])},1386:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var n=t(1527),a=t(1080),o=t.n(a),c=t(959),r=t(7650),i=t(7986),l=t(2530),_=t(1761),u=t(4981),d=t(5177),m=t(4522),g=t(6943),h=t(5817),f=t(891),x=t.n(f),v=t(2657),M=t(4637),p=t(3715),j=t(2987);function C(e){let s=(0,c.useRef)(null),t=(0,c.useRef)(null);return t.current&&t.current.update(e),(0,c.useEffect)(()=>(t.current=new j.cW({...e,ref:s}),()=>{t.current=null}),[]),c.createElement("div",{ref:s})}var w=t(185),y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},N=t(807),k=function(e,s){return c.createElement(N.Z,(0,w.Z)((0,w.Z)({},e),{},{ref:s,icon:y}))};k.displayName="SmileOutlined";var E=c.forwardRef(k),Z=t(8552),S=t(5276),b=t(5858),I=t.n(b);let{TextArea:R}=Z.Z,q=e=>{let{setMessageData:s,interlocutor:t}=e,[a,o]=(0,c.useState)(!1),[r,i]=(0,c.useState)(""),l=(0,_.I0)(),d=(0,c.useRef)(null),m=(0,c.useRef)(null),g=(0,_.v9)(e=>e.socket.socket),h=(0,_.v9)(e=>e.user.user),f=(0,c.useCallback)(e=>{i(s=>s+(null==e?void 0:e.native))},[i]),x=(0,c.useCallback)(()=>{o(e=>!e)},[a,o]),v=(0,c.useCallback)(()=>{r&&g.emit("message",{from:h.id,to:t.id,message:r},e=>{e.between&&(s(e),i(""),l((0,M.kC)(e)))})},[r,g,s,h,t]);return(0,S.t$)(d,e=>{a&&!(e.target==m.current||m.current.contains(e.target))&&o(!1)}),(0,n.jsxs)("div",{className:I().inputs_cont,children:[(0,n.jsx)(R,{value:r,className:I().chat_textarea,onChange:e=>i(e.target.value)}),(0,n.jsx)(E,{ref:m,size:50,className:I().smile_icon,onClick:x}),(0,n.jsx)(u.ZP,{type:"primary",className:I().send_button,onClick:v,children:"Send"}),a&&(0,n.jsx)("div",{ref:d,className:I().emoji_cont,children:(0,n.jsx)(C,{theme:"dark",data:p,onEmojiSelect:f})})]})};var A=t(3686),F=t(2007),z=t(8764),L=t(6186);let P=()=>{var e,s,t;let[a,o]=(0,c.useState)({between:[],messages:[],sequence:[]}),[r,i]=(0,c.useState)({}),[f,p]=(0,c.useState)(!1),[j,C]=(0,c.useState)(!1),w=(0,L.useMediaQuery)({query:"(max-width: 750px)"}),y=(0,L.useMediaQuery)({query:"(max-width: 500px)"}),N=(0,c.useRef)(null),k=(0,_.I0)(),E=(0,_.v9)(e=>e.user.user),[Z,S]=(0,c.useState)(E),b=!(null===(e=Z.friends)||void 0===e?void 0:e.includes(r.id))&&!(null===(s=Z.sentRequests)||void 0===s?void 0:s.includes(r.id)),I=(0,_.v9)(e=>e.messages.interlocutor),R=(0,_.v9)(e=>e.socket.socket),P=(0,l.useRouter)(),{setMessageOptions:Q}=(0,z.Z)(),O=()=>{p(!0),async function(){if(Z.email){var e;let s=await (0,A.Z)("AddFriend",{id:r.id});s.message&&Q({message:s.message,type:"error"}),(null==s?void 0:null===(e=s.AddFriend)||void 0===e?void 0:e.email)?(Q({message:"Request Sent",type:"success"}),k((0,F.W)(s.AddFriend))):s.errors&&Q({message:s.errors[0],type:"error"})}else Q({message:"Sign in to add friends",type:"warning"});p(!1),C(!0)}()};return(0,c.useEffect)(()=>{Z.name?i({}):P.replace("/")},[Z]),(0,c.useEffect)(()=>{i(I),(null==I?void 0:I.name)&&R&&R.emit("newInterlocutor",{id:Z.id,userId:I.id},e=>{console.log({resp:e})})},[I]),(0,c.useEffect)(()=>{o({between:[],messages:[],sequence:[]}),R&&(R.emit("getMessages",{interlocuters:[Z.id,r.id]},e=>{o(e)}),R.on("message",e=>{let s=(0,v.Xw)(null==e?void 0:e.between,Z.id);if(s==r.id){o(e);return}k((0,M.kC)(e))})),i(I)},[r,R]),(0,c.useEffect)(()=>{N.current&&(N.current.scrollTop=N.current.scrollHeight)},[a]),(0,c.useEffect)(()=>{S(E)},[E]),(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:x().chat_cont,style:{width:y?"100%":w?"50%":"60%"},children:r.name?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:x().interlocutor_cont,children:[(0,n.jsx)("div",{children:b&&!j&&(0,n.jsx)(u.ZP,{onClick:()=>O(),className:x().interlocutor_cont_add_friend,loading:f,children:"Add Friend"})}),(0,n.jsxs)("div",{className:x().interlocutor_cont_name,children:[(0,n.jsx)("h5",{className:x().interlocutor_name,children:r.name?r.name.length<15?r.name:(0,v.HY)(r.name,15):""}),(0,n.jsx)(d.Z,{dot:!!r.active,children:(0,n.jsx)(m.C,{className:x().interlocutor_avatar,src:r.image})})]})]}),(0,n.jsx)("div",{className:x().messages_cont,ref:N,children:a.messages&&(null===(t=a.messages)||void 0===t?void 0:t.map((e,s)=>{let t=a.between.indexOf(Z.id);return(0,n.jsx)("div",{className:x().message_cont,style:{justifyContent:a.sequence[s]==t?"flex-end":"flex-start"},children:(0,n.jsx)("div",{className:x().message_cont_text_cont,children:e})},s)}))}),(0,n.jsx)(q,{setMessageData:o,interlocutor:r})]}):(0,n.jsxs)("div",{className:x().choose_interlocutor_cont,children:[(0,n.jsx)(h.Z,{className:x().choose_interlocutor_icon}),(0,n.jsx)(g.Z,{className:x().choose_interlocutor,children:"Choose your interlocutor and start messaging"})]})})})};var Q=t(9728),O=t(3477),D=t.n(O);let G=()=>{let[e,s]=(0,c.useState)(100),[t,a]=(0,c.useState)([]),o=(0,L.useMediaQuery)({query:"(max-width: 750px)"}),r=(0,L.useMediaQuery)({query:"(max-width: 500px)"}),i=e=>{!async function(){var t;let n=await (0,A.Z)("GetLastMessages",{page:e});a(e=>{var s;return[...e,...(null==n?void 0:null===(s=n.GetLastMessages)||void 0===s?void 0:s.users)||[]]}),s(null==n?void 0:null===(t=n.GetLastMessages)||void 0===t?void 0:t.total)}()};return(0,c.useEffect)(()=>{i(1)},[]),(0,n.jsxs)("div",{className:D().lastMessages_cont,style:{width:r?"100%":o?"50%":"40%"},children:[(0,n.jsx)(g.Z,{className:D().lastMessages_cont_title,children:"Last Messages"}),(0,n.jsx)("div",{className:"centered_users_cont",children:(0,n.jsx)(Q.Z,{getUsers:e=>i(e),lastMessages:!0,total:e,users:t})})]})},{Content:X}=r.Z,H=()=>{let e=(0,l.useRouter)(),s=(0,_.v9)(e=>e.window.menuOption),t=(0,L.useMediaQuery)({query:"(max-width: 500px)"});return(0,c.useEffect)(()=>{let s=localStorage.getItem("token");s||e.replace(404)},[]),(0,n.jsxs)(X,{style:{height:"calc(100vh - 180px)"},children:[(0,n.jsx)(o(),{children:(0,n.jsx)("title",{children:"My Messages"})}),(0,n.jsx)(i.Z,{style:{height:"100%",border:"1px solid green"},children:t?"chat"===s?(0,n.jsx)(P,{}):(0,n.jsx)(G,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(G,{}),(0,n.jsx)(P,{})]})})]})};var T=H},3477:function(e){e.exports={lastMessages_cont:"LastMessages_lastMessages_cont__045ax",lastMessages_cont_title:"LastMessages_lastMessages_cont_title__DhfvP"}},891:function(e){e.exports={chat_cont:"MessagesChat_chat_cont__VQpAz",interlocutor_cont:"MessagesChat_interlocutor_cont__uh2E_",interlocutor_cont_info:"MessagesChat_interlocutor_cont_info__RFQP_",interlocutor_cont_info_icon:"MessagesChat_interlocutor_cont_info_icon__HIdZ4",interlocutor_cont_info_active:"MessagesChat_interlocutor_cont_info_active__F2nFc",interlocutor_cont_name:"MessagesChat_interlocutor_cont_name__MLpoE",interlocutor_name:"MessagesChat_interlocutor_name__vpV4V",interlocutor_avatar:"MessagesChat_interlocutor_avatar__m0gJ4",interlocutor_cont_add_friend:"MessagesChat_interlocutor_cont_add_friend__RApOz",messages_cont:"MessagesChat_messages_cont__J_DJ9",message_cont:"MessagesChat_message_cont__aUOVn",message_cont_text_cont:"MessagesChat_message_cont_text_cont__vYbfc",choose_interlocutor_cont:"MessagesChat_choose_interlocutor_cont__8nZL2",choose_interlocutor:"MessagesChat_choose_interlocutor__piGDX",choose_interlocutor_icon:"MessagesChat_choose_interlocutor_icon__6aGg7",chat_icon:"MessagesChat_chat_icon__fe6IP"}},5858:function(e){e.exports={inputs_cont:"MessagesInput_inputs_cont__9sTio",chat_textarea:"MessagesInput_chat_textarea__Smawk",smile_cont:"MessagesInput_smile_cont__lsXct",smile_icon:"MessagesInput_smile_icon__guhM0",send_button:"MessagesInput_send_button__3QP79",emoji_cont:"MessagesInput_emoji_cont__RziDt"}},1080:function(e,s,t){e.exports=t(5907)}},function(e){e.O(0,[910,495,774,888,179],function(){return e(e.s=7675)}),_N_E=e.O()}]);