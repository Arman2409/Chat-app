import { useEffect, useState } from "react";
import Head from 'next/head';
import { Row } from 'antd';
import { useDispatch } from "react-redux";
import { useSelector } from "react-redux";

import SearchUser from '../components/Parts/FindUser/FindUser';
import Welcome from "../components/Parts/Welcome/Welcome";
import { setMessagesData } from "../store/messagesSlice";
import { IRootState } from "../store/store";
import { useMediaQuery } from "react-responsive";

export default function Home() {
    const dispatch = useDispatch();
    const socket = useSelector((state: IRootState) => {
        return state.socket.socket;
    });
    const menuOption = useSelector((state: IRootState) => {
        return state.window.menuOption;
    });
    const user = useSelector((state: IRootState) => {
        return state.user.user;
    });
   const isSmall: boolean = useMediaQuery({ query: "(max-width: 500px)" });

    useEffect(() => {
        if (user.name) {
            socket.on("message", (data: any) => {
                dispatch(setMessagesData(data));
            })
        }
    }, [user])

    return (
        <div className="h-100">
            <Head>
                <title>Talk Space</title>
                <meta name="description" content="Generated by create next app" />
                <link rel="icon" href="/favicon.png" />
            </Head>
            <Row className="w-100 h-100">
                {isSmall ? menuOption === "news" ?
                   <Welcome /> :
                   <SearchUser /> : <>
                       <Welcome />
                       <SearchUser />
                 </>}
            </Row>
        </div>
    )
}
